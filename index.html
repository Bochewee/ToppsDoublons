<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recherche Topps manquant</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Recherche les sticker qu'il te manque</h1>
  <div class="filter-container">
    <div class="filter">
      <label for="numCase">Num case:</label>
      <input type="text" id="numCase">
    </div>
    <div class="filter">
      <label for="type">Type:</label>
      <input type="text" id="type">
    </div>
    <div class="filter">
      <label for="pays">Pays:</label>
      <input type="text" id="pays">
    </div>
    <div class="filter">
      <label for="rarete">Rareté:</label>
      <select id="rarete">
        <option value="">Tous</option>
        <option value="Argent">Argent</option>
        <option value="Point">Point</option>
        <option value="Epic">Epic</option>
        <option value="Topps">Topps</option>
        <option value="Vert">Vert</option>
        <option value="Bleu">Bleu</option>
        <option value="Demi">Demi</option>
        <option value="Legende">Legende</option>
        <option value="PTW">PTW</option>
        <option value="SP">SP</option>
      </select>
    </div>
  </div>
  <button onclick="filterData()">Rechercher</button>
  <table id="data-table">
    <thead>
      <tr>
        <th>Num case</th>
        <th>Type</th>
        <th>Pays</th>
        <th>Rareté</th>
        <th>Stock</th>
      </tr>
    </thead>
    <tbody id="data-body">
      <!-- Les données seront insérées ici -->
    </tbody>
  </table>

  <script>
    let data = [];

    const API_URL = 'https://script.google.com/macros/s/AKfycbyXSCbI2hq_1mbn6czvzRJtKcFl-mAEXbA1P2pJfuP8ftOY1gRKJZlLnNJydNJPG0WF/exec';

    fetch(API_URL)
      .then(response => response.json())
      .then(json => {
        data = json;
        displayData(data);
      });

    function displayData(data) {
      const tableBody = document.getElementById('data-body');
      tableBody.innerHTML = '';
      const stockMap = new Map();

      data.forEach(row => {
        const key = `${row.numCase}-${row.type}-${row.pays}-${row.rarete}`;
        if (stockMap.has(key)) {
          stockMap.set(key, stockMap.get(key) + 1);
        } else {
          stockMap.set(key, 1);
        }
      });

      stockMap.forEach((stock, key) => {
        const [numCase, type, pays, rarete] = key.split('-');
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${numCase}</td>
          <td>${type}</td>
          <td>${pays}</td>
          <td>${rarete}</td>
          <td>${stock}</td>
        `;
        tableBody.appendChild(tr);
      });
    }

    function filterData() {
      const numCase = document.getElementById('numCase').value.toLowerCase();
      const type = document.getElementById('type').value.toLowerCase();
      const pays = document.getElementById('pays').value.toLowerCase();
      const rarete = document.getElementById('rarete').value.toLowerCase();

      const filteredData = data.filter(row => {
        const matchesNumCase = !numCase || row.numCase.toString().toLowerCase().includes(numCase);
        const matchesType = !type || row.type.toLowerCase().includes(type);
        const matchesPays = !pays || row.pays.toLowerCase().includes(pays);
        const matchesRarete = !rarete || row.rarete.toLowerCase().includes(rarete);

        return matchesNumCase && matchesType && matchesPays && matchesRarete;
      });

      displayData(filteredData);
    }
  </script>
</body>
</html>
